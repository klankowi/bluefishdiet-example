---
title: "VAST take 2"
author: "Sarah Gaichas"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_fold: hide
link-citations: yes
csl: ices-journal-of-marine-science.csl
bibliography: FishDiet_EcoIndicators.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

library(tidyverse)
library(here)
#library(DT)
#library(pdftools)
#library(patchwork)
#library(ggiraph)

#library(ecodata)
library(VAST)
```

The model fails with the full dataset. After discussion with both the working group and Elizabeth Ng, we will limit the years to assessment years (1985 to present) and limit the areas to those north of Cape Hatteras due to problems with patchy southern sampling.

Having built an initial dataset of haul-specific mean bluefish prey weight per stomach for piscivores, now we'll try to get a forage biomass index using VAST.

The approach here is to use exactly what @ng_predator_2021 for herring, but combining all bluefish prey (defined [here](https://sgaichas.github.io/bluefishdiet/PreyAggs.html)) as sampled by all piscivore predators at each station.

In @ng_predator_2021, seasons were modeled separately, so we will start that way as well. They used 100 knots, estimated by k-means clustering of the data, to define the spatial dimensions of each seasonal model. They used a a Poisson-link delta model to estimate expected prey mass per predator stomach.  

Try the simplest possible index standardization model, fall (run from script `VASTunivariate_bluefishprey.R`, *not* in rmd):

```{r, code = readLines(here("VASTunivariate_bluefishprey.R")), eval=F}
```

R console output of full script:
```

```